<app-navbar></app-navbar>

<div id="main-card" class="card ml-3 mr-3 text-justify">
  <div class="card-body">
    <div class="row" style="margin-left: .0rem!important; margin-right: .0rem!important;">
      <div class="col-md-12 col-sm-12">
        <nav aria-label="breadcrumb" class="mr-2 ml-2">
          <ol class="breadcrumb mt-3">
            <li class="breadcrumb-item"><a style="color:#6c757d;" href="" routerLink="/home">Home</a></li>
            <li class="breadcrumb-item active" aria-current="page">Pannello di Controllo</li>            
          </ol>
        </nav>
      </div>
    </div>

    <div class="row" style="margin-left: .0rem!important; margin-right: .0rem!important;">
      <div id="left" class="col-md-3 col-sm-12 full-height">
        <div class="row" style="margin-left: .0rem!important; margin-right: .0rem!important;">
          <div class="col col-sm-12 mb-2 mt-2">
            <div class="card ml-2 mr-2 mt-1">
              <div class="text-center status-hosts">
                <p class="card-item-title" style="margin-bottom: 0;">Men√π Amministrazione</p>
              </div>
              <div class="row mt-2">
    						<div class="text-center col-3 icon-text">
                  <i class="fa fa-building" aria-hidden="true"></i>
                </div>
    						<div class="col-6 item-clickable item-text" (click)="changeView(1, 'Gestione Clienti', '', '');">Gestione Clienti</div>
              </div>
              <div class="row">
    						<div class="text-center col-3 icon-text">
                  <i class="fa fa-user" aria-hidden="true"></i>
                </div>
    						<div class="col-6 item-clickable item-text" (click)="changeView(0, 'Gestione Utenti', '', '');">Gestione Utenti</div>
              </div>
              <div class="row">
                <div class="text-center col-3 icon-text">
                  <i class="fa fa-file-text" aria-hidden="true"></i>
                </div>
                <div class="col-6 item-clickable item-text" (click)="changeView(2, 'Gestione Logs', '', '');">Gestione Logs</div>
              </div>
            </div>
          </div>
        </div>
      </div>


      <div class="col-md-9 col-sm-12">
        <div class="row" style="margin-left: .0rem!important; margin-right: .0rem!important;">
          <div class="col col-sm-12 mb-2 mt-2">

            <div class="card ml-2 mr-2 mt-1">
              <div class="pl-3 mb-2 status-hosts">
                <p class="card-item-title" style="margin-bottom: 0;">{{viewTitle}}</p>
              </div>

              <div class="card-body ml-2 mr-2">
                <div class="row" style="margin-left: .0rem!important; margin-right: .0rem!important;" *ngIf="viewPanel == 0">
                  <div class="col-md-12 col-sm-12">
                    <div class="row" style="margin-left: .0rem!important; margin-right: .0rem!important;">
                      <div class="col-md-9 col-sm-12 mb-2 mt-1">
                        <nav class="navbar" style="padding: 0;">
                          <div class="input-group">
                            <div class="input-group-prepend">
                              <div class="input-group-text"><i class='fa fa-search' aria-hidden='true'></i></div>
                            </div>
                            <input class="form-control" type="text" name="search" [(ngModel)]="filter" placeholder="Cerca...">
                          </div>
                        </nav>
                      </div>
                      <div class="col-md-3 col-sm-12 text-right mb-2 mt-1">
                        <button type="button" class="btn btn-success card-item-title create-up" (click)="resetAlertMessage();" data-toggle="modal" data-target="#createModal"><i class="fa fa-plus" aria-hidden="true"></i> Crea utente</button>
                      </div>
                    </div>
                    <div class="row mt-1" style="margin-left: .0rem!important; margin-right: .0rem!important;">
                      <div class="col-md-12 col-sm-12">
                        <table class="table table-responsive w-100 d-block d-md-table table-sm table-hover" *ngIf="users">
                          <thead class="card-item-title" style="color: #172559;">
                            <td scope="col">
                              <i class="fa fa-building" aria-hidden="true"></i>
                              Azienda                           
                            </td>
                            <td scope="col">
                              <i class="fa fa-address-card" aria-hidden="true"></i>
                              Nome                           
                            </td>
                            <td scope="col">
                              <i class="fa fa-address-card-o" aria-hidden="true"></i>
                              Cognome                           
                            </td>
                            <td scope="col">
                              <i class="fa fa-user" aria-hidden="true"></i>
                              Username                      
                            </td>
                            <td></td>
                            <td></td>
                          </thead>
                          <tbody>
                            <tr *ngFor="let user of users | filter:filter | paginate: { id: 'users_pagination', itemsPerPage: 10, currentPage: page_users };" class="item-text-big">
                              <td>{{user.customer_name}}</td>
                              <td>{{user.firstname}}</td>
                              <td>{{user.lastname}}</td>
                              <td>{{user.username}}</td>
                              <td class="text-right"><span class="badge badge-warning item-clickable" (click)="editUser(user);" data-toggle="modal" data-target="#editUserModal"><i class="fa fa-pencil-square" aria-hidden="true"></i> Modifica</span></td>          
              
                              <td><span class="badge badge-danger item-clickable" data-toggle="modal" data-target="#deleteUserModal" (click)="useUser(user)"><i class="fa fa-trash" aria-hidden="true"></i> Elimina</span></td>
                            </tr>
                          </tbody>
                        </table>
                        <div class="modal fade" id="createModal" tabindex="-1" role="dialog" aria-labelledby="createModalLabel" aria-hidden="true">
                          <div class="modal-dialog" role="document">
                            <div class="modal-content">
                              <div class="modal-header">
                                <h5 class="modal-title" id="createModalLabel">Crea utente</h5>
                                <button #btnUserCreate type="button" class="close" data-dismiss="modal" aria-label="Close">
                                  <span aria-hidden="true">&times;</span>
                                </button>
                              </div>
                              <div class="modal-body">
                                <form name="form" (ngSubmit)="f.form.valid && signup(f)" #f="ngForm" novalidate>
                                  <div class="row">
                                    <div class="col-md-6 col-sm-12">
                                      <p class="login-label">Nome</p>
                          						<div class="mt-2 mb-3" [ngClass]="{ 'has-error': f.submitted && !firstname.valid }">
                          				      <div class="input-group mb-2">
                          				        <div class="input-group-prepend">
                          				          <div class="input-group-text"><i class="fa fa-address-card" aria-hidden="true"></i></div>
                          				        </div>
                          				        <input type="text" class="form-control" name="firstname" [(ngModel)]="model.firstname" #firstname="ngModel" required />
                          				        <div *ngIf="f.submitted && !firstname.valid" class="help-block">
                          						    	<i class="fa fa-times" aria-hidden="true"></i>
                          								</div>
                          				      </div>
                          						</div>
                                    </div>
                                    <div class="col-md-6 col-sm-12" style="padding-left: .9rem">
                                      <p class="login-label">Cognome</p>
                                      <div class="mt-2 mb-3" [ngClass]="{ 'has-error': f.submitted && !lastname.valid }">
                                        <div class="input-group mb-2">
                                          <div class="input-group-prepend">
                                            <div class="input-group-text"><i class="fa fa-address-card-o" aria-hidden="true"></i></div>
                                          </div>
                                          <input type="text" class="form-control" name="lastname" [(ngModel)]="model.lastname" #lastname="ngModel" required />
                                          <div *ngIf="f.submitted && !lastname.valid" class="help-block">
                                            <i class="fa fa-times" aria-hidden="true"></i>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                  </div>

                                  <p class="login-label">Username</p>
                      						<div class="mt-2 mb-3" [ngClass]="{ 'has-error': f.submitted && !username.valid }">
                      				      <div class="input-group mb-2">
                      				        <div class="input-group-prepend">
                      				          <div class="input-group-text"><i class="fa fa-user" aria-hidden="true"></i></div>
                      				        </div>
                      				        <input type="text" class="form-control" name="username" [(ngModel)]="model.username" #username="ngModel" required />
                      				        <div *ngIf="f.submitted && !username.valid" class="help-block">
                      						    	<i class="fa fa-times" aria-hidden="true"></i>
                      								</div>
                      				      </div>
                      						</div>

                                  <p class="login-label">E-Mail</p>
                      						<div class="mt-2 mb-3" [ngClass]="{ 'has-error': f.submitted && !email.valid }">
                      				      <div class="input-group mb-2">
                      				        <div class="input-group-prepend">
                      				          <div class="input-group-text"><i class="fa fa-envelope" aria-hidden="true"></i></div>
                      				        </div>
                      				        <input type="email" class="form-control" name="email" [(ngModel)]="model.email" #email="ngModel" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,3}$" required />
                      				        <div *ngIf="f.submitted && !email.valid" class="help-block">
                      						    	<i class="fa fa-times" aria-hidden="true"></i>
                      								</div>
                      				      </div>
                      						</div>

                      						<p class="login-label">Password</p>
                      						<div class="mt-2" [ngClass]="{ 'has-error': f.submitted && !password.valid }">
                      				      <div class="input-group mb-2">
                      				        <div class="input-group-prepend">
                      				          <div class="input-group-text"><i class="fa fa-lock" aria-hidden="true"></i></div>
                      				        </div>
                      				        <input type="password" class="form-control" name="password" [(ngModel)]="model.password" #password="ngModel" required />
                      				        <div *ngIf="f.submitted && !password.valid" class="help-block">
                                        <i class="fa fa-times" aria-hidden="true"></i>
                                      </div>
                      				      </div>
                      						</div>

                                  <p class="login-label">Conferma Password</p>
                      						<div class="mt-2" [ngClass]="{ 'has-error': f.submitted && !confirmPassword.valid }">
                      				      <div class="input-group mb-2">
                      				        <div class="input-group-prepend">
                      				          <div class="input-group-text"><i class="fa fa-lock" aria-hidden="true"></i></div>
                      				        </div>
                      				        <input type="password" class="form-control" name="confirmPassword" [(ngModel)]="model.confirmPassword" #confirmPassword="ngModel" validateEqual="password" required />
                      				        <div *ngIf="f.submitted && !confirmPassword.valid" class="help-block">
                                        <i class="fa fa-times" aria-hidden="true"></i>
                                      </div>
                      				      </div>
                      						</div>

                                  <p class="login-label">Azienda</p>
                      						<div class="mt-2 mb-3" [ngClass]="{ 'has-error': f.submitted && !customer.valid }">
                      				      <div class="input-group mb-2">
                      				        <div class="input-group-prepend">
                      				          <div class="input-group-text"><i class="fa fa-building" aria-hidden="true"></i></div>
                      				        </div>
                                      <select class="form-control" name="customer" [(ngModel)]="model.customer" #customer="ngModel" required>
                                        <option *ngFor="let company of customers" value="{{company._id}}">{{company.name}}</option>
                                      </select>
                      				        <div *ngIf="f.submitted && !customer.valid" class="help-block">
                      						    	<i class="fa fa-times" aria-hidden="true"></i>
                      								</div>
                      				      </div>
                                  </div>
                                  
                                  <p class="login-label">Ruolo</p>
                      						<div class="mt-2 mb-3" [ngClass]="{ 'has-error': f.submitted && !role.valid }">
                      				      <div class="input-group mb-2">
                      				        <div class="input-group-prepend">
                      				          <div class="input-group-text"><i class="fa fa-group" aria-hidden="true"></i></div>
                      				        </div>
                                      <select class="form-control" name="role" [(ngModel)]="model.role" #role="ngModel" required>
                                        <option value="0">Utente standard</option>
                                        <option value="1">Posdata Helpdesk</option>
                                        <option value="2">Posdata Admin</option>
                                      </select>
                      				        <div *ngIf="f.submitted && !role.valid" class="help-block">
                      						    	<i class="fa fa-times" aria-hidden="true"></i>
                      								</div>
                      				      </div>
                      						</div>

                      						<alert></alert>

                      						<div class="text-center mt-4">
                      							<button [disabled]="loading" class="btn btn-primary card-item-title create-down" type="submit">Registra</button>
                      							<img *ngIf="loading" src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA==" />
                      					  </div>
                      					</form>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="row mb-2">
                      <div class="col-md-12 col-sm-12 text-right">
                        <pagination-controls id="users_pagination" class="my-pagination" (pageChange)="page_users = $event"
                                             autoHide="true"
                                             previousLabel="Indietro"
                                             nextLabel="Avanti"
                                             directionLinks="false"
                        >
                        </pagination-controls>
                      </div>
                    </div>                    
                  </div>
                </div>

                <div class="row" style="margin-left: .0rem!important; margin-right: .0rem!important;" *ngIf="viewPanel == 1">
                  <div class="col-md-12 col-sm-12">
                    <div class="row" style="margin-left: .0rem!important; margin-right: .0rem!important;">
                      <div class="col-md-9 col-sm-12 mb-2 mt-1">
                        <nav class="navbar" style="padding: 0;">
                          <div class="input-group">
                            <div class="input-group-prepend">
                              <div class="input-group-text"><i class='fa fa-search' aria-hidden='true'></i></div>
                            </div>
                            <input class="form-control" type="text" name="search" [(ngModel)]="filter" placeholder="Cerca...">
                          </div>
                        </nav>
                      </div>
                      <div class="col-md-3 col-sm-12 text-right mb-2 mt-1">
                        <button type="button" class="btn btn-success card-item-title create-up" (click)="resetAlertMessage();" data-toggle="modal" data-target="#createCompanyModal"><i class="fa fa-plus" aria-hidden="true"></i> Aggiungi cliente</button>
                      </div>
                    </div>
                    <div class="row mt-1" style="margin-left: .0rem!important; margin-right: .0rem!important;">
                      <div class="col-md-12 col-sm-12">
                        <table class="table table-responsive w-100 d-block d-md-table table-sm table-hover" *ngIf="customers">
                          <thead class="card-item-title" style="color: #172559;">
                            <td scope="col">
                              <i class="fa fa-address-card-o" aria-hidden="true"></i>
                              Ragione Sociale                         
                            </td>
                            <td scope="col">
                              <i class="fa fa-address-card" aria-hidden="true"></i>
                              Referente                           
                            </td>
                            <td scope="col">
                              <i class="fa fa-phone" aria-hidden="true"></i>
                              Telefono                         
                            </td>                       
                            <td></td>
                            <td></td>
                          </thead>
                          <tbody>
                            <tr *ngFor="let company of customers | filter:filter | paginate: { id: 'customers_pagination', itemsPerPage: 10, currentPage: page_customers };" class="item-text-big">
                              <td>{{company.name}}</td>
                              <td>{{company.referent_name}}</td>
                              <td>{{company.phone_number}}</td>                      
                              <td class="text-right"><span class="badge badge-warning item-clickable" data-toggle="modal" data-target="#editCustomerModal" (click)="useCustomerEdit(company)"><i class="fa fa-pencil-square" aria-hidden="true"></i> Modifica</span></td>                              
                              <td><span class="badge badge-danger item-clickable" data-toggle="modal" data-target="#deleteCustomerModal" (click)="useCustomer(company)"><i class="fa fa-trash" aria-hidden="true"></i> Elimina</span></td>
                            </tr>
                          </tbody>
                        </table>
                        <div class="modal fade" id="createCompanyModal" tabindex="-1" role="dialog" aria-labelledby="createCompanyLabel" aria-hidden="true">
                          <div class="modal-dialog" role="document">
                            <div class="modal-content">
                              <div class="modal-header">
                                <h5 class="modal-title" id="createCompanyLabel">Crea cliente</h5>
                                <button #btnCustomerCreate type="button" class="close" data-dismiss="modal" aria-label="Close">
                                  <span aria-hidden="true">&times;</span>
                                </button>
                              </div>
                              <div class="modal-body">
                                <form name="form" (ngSubmit)="f.form.valid && createCompany(f)" #f="ngForm" novalidate>
                                  <div class="row">
                                    <div class="col-md-12 col-sm-12">
                                      <p class="login-label">Ragione Sociale</p>
                          						<div class="mt-2 mb-3" [ngClass]="{ 'has-error': f.submitted && !companyname.valid }">
                          				      <div class="input-group mb-2">
                          				        <div class="input-group-prepend">
                          				          <div class="input-group-text"><i class="fa fa-address-card" aria-hidden="true"></i></div>
                          				        </div>
                          				        <input type="text" class="form-control" name="companyname" autocomplete="companyname" [(ngModel)]="model.companyname" #companyname="ngModel" required />
                          				        <div *ngIf="f.submitted && !companyname.valid" class="help-block">
                          						    	<i class="fa fa-times" aria-hidden="true"></i>
                          								</div>
                          				      </div>
                                      </div>
                                      
                                      <p class="login-label">Codice Cliente</p>
                          						<div class="mt-2 mb-3" [ngClass]="{ 'has-error': f.submitted && !customer_code.valid }">
                          				      <div class="input-group mb-2">
                          				        <div class="input-group-prepend">
                          				          <div class="input-group-text"><i class="fa fa-asterisk" aria-hidden="true"></i></div>
                          				        </div>
                          				        <input type="text" class="form-control" name="customer_code" autocomplete="customer_code" [(ngModel)]="model.customer_code" #customer_code="ngModel" required />
                          				        <div *ngIf="f.submitted && !customer_code.valid" class="help-block">
                          						    	<i class="fa fa-times" aria-hidden="true"></i>
                          								</div>
                          				      </div>
                                      </div>

                                      <p class="login-label">Referente</p>
                          						<div class="mt-2 mb-3" [ngClass]="{ 'has-error': f.submitted && !referent_name.valid }">
                          				      <div class="input-group mb-2">
                          				        <div class="input-group-prepend">
                          				          <div class="input-group-text"><i class="fa fa-address-card-o" aria-hidden="true"></i></div>
                          				        </div>
                          				        <input type="text" class="form-control" name="referent_name" autocomplete="referent_name" [(ngModel)]="model.referent_name" #referent_name="ngModel" required />
                          				        <div *ngIf="f.submitted && !referent_name.valid" class="help-block">
                          						    	<i class="fa fa-times" aria-hidden="true"></i>
                          								</div>
                          				      </div>
                                      </div>
                                      
                                      <p class="login-label">Telefono</p>
                          						<div class="mt-2 mb-3" [ngClass]="{ 'has-error': f.submitted && !phone_number.valid }">
                          				      <div class="input-group mb-2">
                          				        <div class="input-group-prepend">
                          				          <div class="input-group-text"><i class="fa fa-phone" aria-hidden="true"></i></div>
                          				        </div>
                          				        <input type="text" class="form-control" name="phone_number" autocomplete="phone_number" [(ngModel)]="model.phone_number" #phone_number="ngModel" required />
                          				        <div *ngIf="f.submitted && !phone_number.valid" class="help-block">
                          						    	<i class="fa fa-times" aria-hidden="true"></i>
                          								</div>
                          				      </div>
                                      </div>
                                      
                                      <p class="login-label">E-Mail</p>
                                      <div class="mt-2 mb-3" [ngClass]="{ 'has-error': f.submitted && !email.valid }">
                                        <div class="input-group mb-2">
                                          <div class="input-group-prepend">
                                            <div class="input-group-text"><i class="fa fa-envelope" aria-hidden="true"></i></div>
                                          </div>
                                          <input type="email" class="form-control" name="email" autocomplete="email" [(ngModel)]="model.email" #email="ngModel" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,3}$" required />
                                          <div *ngIf="f.submitted && !email.valid" class="help-block">
                                            <i class="fa fa-times" aria-hidden="true"></i>
                                          </div>
                                        </div>
                                      </div>

                                      <p class="login-label">Logo</p>
                          						<div class="mt-2 mb-3">
                                          <input type="file" name="file" id="file" (change)="onFileChanged($event)" />
                          						</div>
                                    </div>
                                  </div>

                      						<alert></alert>

                      						<div class="text-center mt-4">
                      							<button [disabled]="loading" class="btn btn-primary card-item-title create-down" type="submit">Registra</button>
                      							<img *ngIf="loading" src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA==" />
                      					  </div>
                      					</form>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-12 col-sm-12 mt-1 text-right">
                        <pagination-controls id="customers_pagination" class="my-pagination" (pageChange)="page_customers = $event"
                                             autoHide="true"
                                             previousLabel="Indietro"
                                             nextLabel="Avanti"
                                             directionLinks="false"
                        >
                        </pagination-controls>
                      </div>
                    </div>
                  </div>
                </div>         

                <div class="row" style="margin-left: .0rem!important; margin-right: .0rem!important;" *ngIf="viewPanel == 2">
                  <div class="col-md-12 col-sm-12">
                    <div class="row" style="margin-left: .0rem!important; margin-right: .0rem!important;">
                      <div class="col-md-12 col-sm-12 mb-2 mt-1">
                        <form name="form" (ngSubmit)="logForm.form.valid && searchLog(logForm) && logForm.reset()" #logForm="ngForm" novalidate>
                          <p class="login-label">Utente</p>
                          <div class="mt-2 mb-3" [ngClass]="{ 'has-error': logForm.submitted && !user.valid }">
                            <div class="input-group mb-2">
                              <div class="input-group-prepend">
                                <div class="input-group-text"><i class="fa fa-user" aria-hidden="true"></i></div>
                              </div>
                              <select class="form-control" name="user" [(ngModel)]="logModel.user" #user="ngModel" required>
                                <option *ngFor="let user of users" value="{{user._id}}">{{user.customer_name}} - {{user.firstname}} {{user.lastname}}</option>
                              </select>
                              <div *ngIf="logForm.submitted && !user.valid" class="help-block">
                                <i class="fa fa-times" aria-hidden="true"></i>
                              </div>
                            </div>
                          </div>

                          <div class="row">
                            <div class="col-md-9 col-sm-12">
                              <p class="login-label">Filtro azione</p>
                              <div class="mt-2 mb-3" [ngClass]="{ 'has-error': logForm.submitted && !action.valid }">
                                <div class="input-group mb-2">
                                  <div class="input-group-prepend">
                                    <div class="input-group-text"><i class="fa fa-filter" aria-hidden="true"></i></div>
                                  </div>
                                  <select class="form-control" name="action" [(ngModel)]="logModel.action" #action="ngModel" required>
                                    <option *ngFor="let action of actionDescriptions" [ngClass]="{ 'font-weight-bold': action.bold }" value="{{action.type}}">{{action.description}}</option>
                                  </select>
                                  <div *ngIf="logForm.submitted && !action.valid" class="help-block">
                                    <i class="fa fa-times" aria-hidden="true"></i>
                                  </div>
                                </div>
                              </div>
                            </div>
                            <div class="col-md-3 col-sm-12 text-right mb-2 mt-1" style="margin-top: 2.4rem!important;">
                              <button type="button" class="btn btn-info card-item-title create-info" type="submit"><i class="fa fa-search" aria-hidden="true"></i> Cerca</button>
                            </div>
                          </div>
                        </form>
                      </div>
                    </div>
                    <div class="row mt-1" style="margin-left: .0rem!important; margin-right: .0rem!important;">
                      <div class="col-md-12 col-sm-12">
                        <table class="table table-responsive w-100 d-block d-md-table table-sm table-hover" *ngIf="user_logs">
                          <thead class="card-item-title" style="color: #172559;">
                            <td scope="col">
                              <i class="fa fa-calendar" aria-hidden="true"></i>
                              Data                         
                            </td>
                            <td scope="col">
                              <i class="fa fa-filter" aria-hidden="true"></i>
                              Azione                           
                            </td>
                            <td scope="col">
                              <i class="fa fa-file-text" aria-hidden="true"></i>
                              Descrizione                         
                            </td>                       
                            <td></td>
                            <td></td>
                          </thead>
                          <tbody>
                            <tr *ngFor="let user_log of user_logs" class="item-text-big">
                              <td>{{user_log.created_at}}</td>
                              <td>{{actionDescriptions[user_log.action_type].description}}</td>
                              <td>{{user_log.message}}</td>                            
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>           
                  </div>
                </div>                
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="deleteCustomerModal" tabindex="-1" role="dialog" aria-labelledby="deleteCustomerLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content" *ngIf="use_customer">
        <div class="modal-header">
          <h5 class="modal-title" id="deleteCustomerLabel">Elimina cliente: {{use_customer.name}}</h5>
          <button #btnCustomerClose type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" style="padding-bottom: 0">
          <p class="item-text-big">Sei sicuro di voler eliminare definitivamente il cliente?</p>
          <alert></alert>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Indietro</button>
          <button type="button" class="btn btn-danger" (click)="deleteCustomer(use_customer._id)"><i class="fa fa-trash" aria-hidden="true"></i> Elimina</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="deleteUserModal" tabindex="-1" role="dialog" aria-labelledby="deleteUserLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content" *ngIf="use_user">
        <div class="modal-header">
          <h5 class="modal-title" id="deleteUserLabel">Elimina utente: {{use_user.firstname}} {{use_user.lastname}} ({{use_user.username}})</h5>
          <button #btnUserClose type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" style="padding-bottom: 0">
          <p class="item-text-big">Sei sicuro di voler eliminare definitivamente l'utente?</p>
          <alert></alert>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Indietro</button>
          <button type="button" class="btn btn-danger" (click)="deleteUser(use_user._id)"><i class="fa fa-trash" aria-hidden="true"></i> Elimina</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="editCustomerModal" tabindex="-1" role="dialog" aria-labelledby="editCustomerLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
      <div class="modal-content" *ngIf="use_customer">
        <div class="modal-header">
          <h5 class="modal-title" id="editCustomerLabel">Modifica cliente: {{use_customer.name}}</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-md-12 col-sm-12"> 
              <img [src]="'data:image;base64,'+use_customer.logo | safeHtml" style="height: 40px;">
            </div>
          </div>          
          <div class="row">
            <div class="col-md-12 col-sm-12">                    
              <form name="form" (ngSubmit)="customerForm.form.valid && updateCustomer(customerForm, use_customer) && customerForm.reset()" #customerForm="ngForm" novalidate>
                <div class="row">
                  <div class="col-md-4 col-sm-12">
                    <p class="login-label">Ragione Sociale</p>
                    <div class="mt-2 mb-3" [ngClass]="{ 'has-error': customerForm.submitted && !companyname.valid }">
                      <div class="input-group mb-2">
                        <div class="input-group-prepend">
                          <div class="input-group-text"><i class="fa fa-address-card" aria-hidden="true"></i></div>
                        </div>
                        <input type="text" class="form-control" name="companyname" autocomplete="companyname" [(ngModel)]="customerModel.companyname" #companyname="ngModel" />
                        <div *ngIf="customerForm.submitted && !companyname.valid" class="help-block">
                          <i class="fa fa-times" aria-hidden="true"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4 col-sm-12" style="padding-left: .9rem">
                    <p class="login-label">Codice Cliente</p>
                    <div class="mt-2 mb-3" [ngClass]="{ 'has-error': customerForm.submitted && !customer_code.valid }">
                      <div class="input-group mb-2">
                        <div class="input-group-prepend">
                          <div class="input-group-text"><i class="fa fa-asterisk" aria-hidden="true"></i></div>
                        </div>
                        <input type="text" class="form-control" name="customer_code" autocomplete="customer_code" [(ngModel)]="customerModel.customer_code" #customer_code="ngModel" />
                        <div *ngIf="customerForm.submitted && !customer_code.valid" class="help-block">
                          <i class="fa fa-times" aria-hidden="true"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4 col-sm-12" style="padding-left: .9rem">
                    <p class="login-label">Referente</p>
                    <div class="mt-2 mb-3" [ngClass]="{ 'has-error': customerForm.submitted && !referent_name.valid }">
                      <div class="input-group mb-2">
                        <div class="input-group-prepend">
                          <div class="input-group-text"><i class="fa fa-address-card-o" aria-hidden="true"></i></div>
                        </div>
                        <input type="text" class="form-control" name="referent_name" autocomplete="referent_name" [(ngModel)]="customerModel.referent_name" #referent_name="ngModel" />
                        <div *ngIf="customerForm.submitted && !referent_name.valid" class="help-block">
                          <i class="fa fa-times" aria-hidden="true"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">                       
                  <div class="col-md-4 col-sm-12">
                    <p class="login-label">Telefono</p>
                    <div class="mt-2 mb-3" [ngClass]="{ 'has-error': customerForm.submitted && !phone_number.valid }">
                      <div class="input-group mb-2">
                        <div class="input-group-prepend">
                          <div class="input-group-text"><i class="fa fa-phone" aria-hidden="true"></i></div>
                        </div>
                        <input type="text" class="form-control" name="phone_number" autocomplete="phone_number" [(ngModel)]="customerModel.phone_number" #phone_number="ngModel" />
                        <div *ngIf="customerForm.submitted && !phone_number.valid" class="help-block">
                          <i class="fa fa-times" aria-hidden="true"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4 col-sm-12" style="padding-left: .9rem">                       
                    <p class="login-label">E-Mail</p>
                    <div class="mt-2 mb-3" [ngClass]="{ 'has-error': customerForm.submitted && !email.valid }">
                      <div class="input-group mb-2">
                        <div class="input-group-prepend">
                          <div class="input-group-text"><i class="fa fa-envelope" aria-hidden="true"></i></div>
                        </div>
                        <input type="email" class="form-control" name="email" autocomplete="email" [(ngModel)]="customerModel.email" #email="ngModel" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,3}$" />
                        <div *ngIf="customerForm.submitted && !email.valid" class="help-block">
                          <i class="fa fa-times" aria-hidden="true"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-2 col-sm-12" style="padding-left: .9rem">
                    <p class="login-label">Logo</p>
                    <div class="mt-2 mb-3">
                        <input type="file" name="file" id="file" (change)="onFileChanged($event)" />
                    </div>
                  </div>
                  <div class="col-md-2 col-sm-12 text-right" style="margin-top: 2rem!important;">            

                    <button [disabled]="loading" class="btn btn-success card-item-title create-up" type="submit"><i class="fa fa-floppy-o" aria-hidden="true"></i> Salva</button>
                    <img *ngIf="loading" src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA==" />
                  </div>
                </div>
                <div *ngIf="customerAlert">
                  <alert></alert>           
                </div>           
              </form>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12 col-sm-12">
                <h5 class="modal-title">Lista siti</h5>         
                <hr style="padding: 0;">             
            </div>
          </div>                
          <div class="row">
            <div class="col-md-9 col-sm-12 mb-2 mt-1">      
              <nav class="navbar" style="padding: 0;">
                <div class="input-group">
                  <div class="input-group-prepend">
                    <div class="input-group-text"><i class='fa fa-search' aria-hidden='true'></i></div>
                  </div>
                  <input class="form-control" type="text" name="search" [(ngModel)]="filter" placeholder="Cerca...">
                </div>
              </nav>             
            </div>
            <div class="col-md-3 col-sm-12 text-right mb-2 mt-1">
              <button type="button" class="btn btn-success card-item-title create-up" data-toggle="modal" data-target="#createServerModal"><i class="fa fa-plus" aria-hidden="true"></i> Crea sito</button>
            </div>
          </div>
          <div class="row mt-1">
            <div class="col-md-12 col-sm-12">
              <table class="table table-responsive w-100 d-block d-md-table table-sm table-hover" *ngIf="servers">
                <thead class="card-item-title" style="color: #172559;">
                  <td scope="col">
                    <i class="fa fa-address-card-o" aria-hidden="true"></i>
                    Descrizione                 
                  </td>
                  <td scope="col">
                    <i class="fa fa-podcast" aria-hidden="true"></i>
                    Indirizzo IP                     
                  </td>
                  <td scope="col">
                    <i class="fa fa-sign-in" aria-hidden="true"></i>
                    Porta                     
                  </td>               
                  <td></td>
                  <td></td>
                </thead>
                <tbody>
                  <tr *ngFor="let server of servers | filter:filter | paginate: { id: 'customer_sites_pagination', itemsPerPage: 10, currentPage: page_customer_sites };" class="item-text-big">
                    <td>{{server.description}}</td>
                    <td>{{server.ip_address}}</td>
                    <td>{{server.port_number}}</td>                      
                    <td class="text-right"><span class="badge badge-warning item-clickable" data-toggle="modal" data-target="#editCustomerSiteModal" (click)="useCustomerSiteEdit(server)"><i class="fa fa-pencil-square" aria-hidden="true"></i> Modifica</span></td>                              
                    <td><span class="badge badge-danger item-clickable" (click)="deleteCustomerSite(use_customer._id, server._id)"><i class="fa fa-trash" aria-hidden="true"></i> Elimina</span></td>
                  </tr>
                </tbody>
              </table>                    
            </div>
          </div>
          <div class="row">
            <div class="col-md-12 col-sm-12 mt-1 text-right">
              <pagination-controls id="customer_sites_pagination" class="my-pagination" (pageChange)="page_customer_sites = $event"
                                    autoHide="true"
                                    previousLabel="Indietro"
                                    nextLabel="Avanti"
                                    directionLinks="false"
              >
              </pagination-controls>
            </div>          
          </div>
        </div>        
      </div>
    </div>
  </div>

  <div class="modal fade" id="createServerModal" tabindex="-1" role="dialog" aria-labelledby="createServerModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content" *ngIf="use_customer">
        <div class="modal-header">
          <h5 class="modal-title" id="createServerModalLabel">Crea sito</h5>
          <button #btnCustomerSiteClose type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form name="form" (ngSubmit)="f.form.valid && createServer(f, use_customer._id)" #f="ngForm" novalidate>
            <p class="login-label">Descrizione</p>
            <div class="mt-2 mb-3" [ngClass]="{ 'has-error': f.submitted && !description.valid }">
              <div class="input-group mb-2">
                <div class="input-group-prepend">
                  <div class="input-group-text"><i class="fa fa-address-card-o" aria-hidden="true"></i></div>
                </div>
                <input type="text" class="form-control" name="description" autocomplete="description" [(ngModel)]="model.description" #description="ngModel" required />
                <div *ngIf="f.submitted && !description.valid" class="help-block">
                  <i class="fa fa-times" aria-hidden="true"></i>
                </div>
              </div>
            </div>

            <p class="login-label">Indirizzo IP</p>
            <div class="mt-2 mb-3" [ngClass]="{ 'has-error': f.submitted && !address.valid }">
              <div class="input-group mb-2">
                <div class="input-group-prepend">
                  <div class="input-group-text"><i class="fa fa-podcast" aria-hidden="true"></i></div>
                </div>
                <input type="text" class="form-control" name="address" autocomplete="address" [(ngModel)]="model.address" #address="ngModel" required />
                <div *ngIf="f.submitted && !address.valid" class="help-block">
                  <i class="fa fa-times" aria-hidden="true"></i>
                </div>
              </div>
            </div>

            <p class="login-label">Porta</p>
            <div class="mt-2" [ngClass]="{ 'has-error': f.submitted && !port.valid }">
              <div class="input-group mb-2">
                <div class="input-group-prepend">
                  <div class="input-group-text"><i class="fa fa-sign-in" aria-hidden="true"></i></div>
                </div>
                <input type="text" class="form-control" name="port" autocomplete="current-port" [(ngModel)]="model.port" #port="ngModel" required />
                <div *ngIf="f.submitted && !port.valid" class="help-block">
                  <i class="fa fa-times" aria-hidden="true"></i>
                </div>
              </div>
            </div>

            <alert></alert>

            <div class="text-center mt-4">
              <button [disabled]="loading" class="btn btn-primary card-item-title create-down" type="submit">Registra</button>
              <img *ngIf="loading" src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA==" />
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="editCustomerSiteModal" tabindex="-1" role="dialog" aria-labelledby="editCustomerSiteModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content" *ngIf="use_customer_site">
          <div class="modal-header">
            <h5 class="modal-title" id="editCustomerSiteModalLabel">Modifica sito: {{use_customer.name}} - {{use_customer_site.description}} </h5>
            <button #btnCustomerSiteClose type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form name="form" (ngSubmit)="f.form.valid && updateServer(f, use_customer_site, use_customer)" #f="ngForm" novalidate>
              <p class="login-label">Descrizione</p>
              <div class="mt-2 mb-3" [ngClass]="{ 'has-error': f.submitted && !description.valid }">
                <div class="input-group mb-2">
                  <div class="input-group-prepend">
                    <div class="input-group-text"><i class="fa fa-address-card-o" aria-hidden="true"></i></div>
                  </div>
                  <input type="text" class="form-control" name="description" autocomplete="description" [(ngModel)]="model.description" #description="ngModel" value="{{use_customer_site.description}}" placeholder="{{use_customer_site.description}}"/>
                  <div *ngIf="f.submitted && !description.valid" class="help-block">
                    <i class="fa fa-times" aria-hidden="true"></i>
                  </div>
                </div>
              </div>
  
              <p class="login-label">Indirizzo IP</p>
              <div class="mt-2 mb-3" [ngClass]="{ 'has-error': f.submitted && !address.valid }">
                <div class="input-group mb-2">
                  <div class="input-group-prepend">
                    <div class="input-group-text"><i class="fa fa-podcast" aria-hidden="true"></i></div>
                  </div>
                  <input type="text" class="form-control" name="address" autocomplete="address" [(ngModel)]="model.address" #address="ngModel" value="{{use_customer_site.ip_address}}" placeholder="{{use_customer_site.ip_address}}" />
                  <div *ngIf="f.submitted && !address.valid" class="help-block">
                    <i class="fa fa-times" aria-hidden="true"></i>
                  </div>
                </div>
              </div>
  
              <p class="login-label">Porta</p>
              <div class="mt-2" [ngClass]="{ 'has-error': f.submitted && !port.valid }">
                <div class="input-group mb-2">
                  <div class="input-group-prepend">
                    <div class="input-group-text"><i class="fa fa-sign-in" aria-hidden="true"></i></div>
                  </div>
                  <input type="text" class="form-control" name="port" autocomplete="current-port" [(ngModel)]="model.port" #port="ngModel" value="{{use_customer_site.port_number}}" placeholder="{{use_customer_site.port_number}}" />
                  <div *ngIf="f.submitted && !port.valid" class="help-block">
                    <i class="fa fa-times" aria-hidden="true"></i>
                  </div>
                </div>
              </div>
  
              <alert></alert>
  
              <div class="text-center mt-4">
                <button [disabled]="loading" class="btn btn-success card-item-title create-up" type="submit"><i class="fa fa-floppy-o" aria-hidden="true"></i> Salva</button>
                <img *ngIf="loading" src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA==" />
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

  <div class="modal fade" id="editUserModal" tabindex="-1" role="dialog" aria-labelledby="editUserLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
      <div class="modal-content" *ngIf="use_user">
        <div class="modal-header">
          <h5 class="modal-title" id="editUserLabel">Modifica utente: {{use_user.firstname}} {{use_user.lastname}} ({{use_user.username}})</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
           <div class="card ml-2 mr-2 mt-1 mb-2">
            <div class="pl-3 mb-2 status-hosts">
              <p class="card-item-title text-center" style="margin-bottom: 0;">Informazioni utente</p>
            </div>
            <div class="card-body ml-2 mr-2 mb-2">
              <div class="row">
                <div class="col-md-12 col-sm-12">                    
                  <form name="form" (ngSubmit)="userForm.form.valid && updateUser(userForm, use_user) && userForm.reset()" #userForm="ngForm" novalidate>
                    <div class="row">
                      <div class="col-md-4 col-sm-12">
                        <p class="login-label">Nome</p>
                        <div class="mt-2 mb-3" [ngClass]="{ 'has-error': userForm.submitted && !firstname.valid }">
                          <div class="input-group mb-2">
                            <div class="input-group-prepend">
                              <div class="input-group-text"><i class="fa fa-address-card" aria-hidden="true"></i></div>
                            </div>
                            <input type="text" class="form-control" name="firstname" [(ngModel)]="userModel.firstname" #firstname="ngModel" />
                            <div *ngIf="userForm.submitted && !firstname.valid" class="help-block">
                              <i class="fa fa-times" aria-hidden="true"></i>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-4 col-sm-12" style="padding-left: .9rem">
                        <p class="login-label">Cognome</p>
                        <div class="mt-2 mb-3" [ngClass]="{ 'has-error': userForm.submitted && !lastname.valid }">
                          <div class="input-group mb-2">
                            <div class="input-group-prepend">
                              <div class="input-group-text"><i class="fa fa-address-card-o" aria-hidden="true"></i></div>
                            </div>
                            <input type="text" class="form-control" name="lastname" [(ngModel)]="userModel.lastname" #lastname="ngModel" />
                            <div *ngIf="userForm.submitted && !lastname.valid" class="help-block">
                              <i class="fa fa-times" aria-hidden="true"></i>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-4 col-sm-12" style="padding-left: .9rem">
                        <p class="login-label">Username</p>
                        <div class="mt-2 mb-3" [ngClass]="{ 'has-error': userForm.submitted && !username.valid }">
                          <div class="input-group mb-2">
                            <div class="input-group-prepend">
                              <div class="input-group-text"><i class="fa fa-user" aria-hidden="true"></i></div>
                            </div>
                            <input type="text" class="form-control" name="username" [(ngModel)]="userModel.username" #username="ngModel" />
                            <div *ngIf="userForm.submitted && !username.valid" class="help-block">
                              <i class="fa fa-times" aria-hidden="true"></i>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    
                    <div class="row">
                      <div class="col-md-4 col-sm-12">
                        <p class="login-label">E-Mail</p>
                        <div class="mt-2 mb-3" [ngClass]="{ 'has-error': userForm.submitted && !email.valid }">
                          <div class="input-group mb-2">
                            <div class="input-group-prepend">
                              <div class="input-group-text"><i class="fa fa-envelope" aria-hidden="true"></i></div>
                            </div>
                            <input type="email" class="form-control" name="email" [(ngModel)]="userModel.email" #email="ngModel" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,3}$" />
                            <div *ngIf="userForm.submitted && !email.valid" class="help-block">
                              <i class="fa fa-times" aria-hidden="true"></i>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-4 col-sm-12" style="padding-left: .9rem">
                        <p class="login-label">Cellulare</p>
                        <div class="mt-2 mb-3" [ngClass]="{ 'has-error': userForm.submitted && !phone_number.valid }">
                          <div class="input-group mb-2">
                            <div class="input-group-prepend">
                              <div class="input-group-text"><i class="fa fa-phone" aria-hidden="true"></i></div>
                            </div>
                            <input type="text" class="form-control" name="phone_number" [(ngModel)]="userModel.phone_number" #phone_number="ngModel" />
                            <div *ngIf="userForm.submitted && !phone_number.valid" class="help-block">
                              <i class="fa fa-times" aria-hidden="true"></i>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-4 col-sm-12" style="padding-left: .9rem">
                        <p class="login-label">Ufficio</p>
                        <div class="mt-2 mb-3" [ngClass]="{ 'has-error': userForm.submitted && !office_number.valid }">
                          <div class="input-group mb-2">
                            <div class="input-group-prepend">
                              <div class="input-group-text"><i class="fa fa-phone" aria-hidden="true"></i></div>
                            </div>
                            <input type="text" class="form-control" name="office_number" [(ngModel)]="userModel.office_number" #office_number="ngModel" />
                            <div *ngIf="userForm.submitted && !office_number.valid" class="help-block">
                              <i class="fa fa-times" aria-hidden="true"></i>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-4 col-sm-12">
                        <p class="login-label">Telegram ID</p>
                        <div class="mt-2 mb-3" [ngClass]="{ 'has-error': userForm.submitted && !telegram_id.valid }">
                          <div class="input-group mb-2">
                            <div class="input-group-prepend">
                              <div class="input-group-text"><i class="fa fa-telegram" aria-hidden="true"></i></div>
                            </div>
                            <input type="text" class="form-control" name="telegram_id" [(ngModel)]="userModel.telegram_id" #telegram_id="ngModel" />
                            <div *ngIf="userForm.submitted && !telegram_id.valid" class="help-block">
                              <i class="fa fa-times" aria-hidden="true"></i>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="col-md-4 col-sm-12" style="padding-left: .9rem">
                        <p class="login-label">Azienda</p>
                        <div class="mt-2 mb-3" [ngClass]="{ 'has-error': userForm.submitted && !customer.valid }">
                          <div class="input-group mb-2">
                            <div class="input-group-prepend">
                              <div class="input-group-text"><i class="fa fa-building" aria-hidden="true"></i></div>
                            </div>
                            <select class="form-control" name="customer" [(ngModel)]="userModel.customer" #customer="ngModel">
                              <option *ngFor="let company of customers" value="{{company._id}}">{{company.name}}</option>
                            </select>
                            <div *ngIf="userForm.submitted && !customer.valid" class="help-block">
                              <i class="fa fa-times" aria-hidden="true"></i>
                            </div>
                          </div>
                        </div>
                      </div>
                        
                      <div class="col-md-3 col-sm-12" style="padding-left: .9rem">
                        <p class="login-label">Ruolo</p>
                        <div class="mt-2 mb-3" [ngClass]="{ 'has-error': userForm.submitted && !role.valid }">
                          <div class="input-group mb-2">
                            <div class="input-group-prepend">
                              <div class="input-group-text"><i class="fa fa-group" aria-hidden="true"></i></div>
                            </div>
                            <select class="form-control" name="role" [(ngModel)]="userModel.role" #role="ngModel">
                              <option value="0">Utente standard</option>
                              <option value="1">Posdata Helpdesk</option>
                              <option value="2">Posdata Admin</option>
                            </select>
                            <div *ngIf="userForm.submitted && !role.valid" class="help-block">
                              <i class="fa fa-times" aria-hidden="true"></i>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="col-md-1 col-sm-12 text-right" style="margin-top: 2.3rem!important;">                
                        <button [disabled]="loading" class="btn btn-success card-item-title create-up" type="submit"><i class="fa fa-floppy-o" aria-hidden="true"></i> Salva</button>
                        <img *ngIf="loading" src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA==" />
                      </div>
                    </div>
                    <alert></alert>                          
                  </form>
                </div>
              </div>
            </div>
          </div>

          <div class="card ml-2 mr-2">
            <div class="pl-3 mb-2 status-hosts">
              <p class="card-item-title text-center" style="margin-bottom: 0;">Lista siti</p>
            </div>

            <div class="card-body ml-2 mr-2 mb-2">
              <div class="row">
                <div class="col-md-9 col-sm-12 mb-2 mt-1">      
                  <nav class="navbar" style="padding: 0;">
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <div class="input-group-text"><i class='fa fa-search' aria-hidden='true'></i></div>
                      </div>
                      <input class="form-control" type="text" name="search" [(ngModel)]="filter" placeholder="Cerca...">
                    </div>
                  </nav>             
                </div>
                <div class="col-md-3 col-sm-12 text-right mb-2 mt-1">
                  <button type="button" class="btn btn-success card-item-title create-up" data-toggle="modal" data-target="#createUserSiteModal" (click)="loadSites()"><i class="fa fa-plus" aria-hidden="true"></i> Aggiungi sito</button>
                </div>
              </div>        
              <div class="row mt-1">
                <div class="col-md-12 col-sm-12">
                  <table class="table table-responsive w-100 d-block d-md-table table-sm table-hover">
                    <thead class="card-item-title" style="color: #172559;">
                      <td scope="col">
                        <i class="fa fa-building" aria-hidden="true"></i>
                        Azienda
                      </td>
                      <td scope="col">
                        <i class="fa fa-address-card" aria-hidden="true"></i>
                        Descrizione
                      </td>
                      <td scope="col">
                        <i class="fa fa-podcast" aria-hidden="true"></i>
                        Indirizzo IP
                      </td>
                      <td scope="col">
                        <i class="fa fa-sign-in" aria-hidden="true"></i>
                        Porta
                      </td>
                      <td></td>              
                    </thead>
                    <tbody *ngIf="user_sites">
                      <tr *ngFor="let user_site of user_sites | filter:filter | paginate: { id: 'user_sites_pagination', itemsPerPage: 10, currentPage: page_user_sites };" class="item-text-big">
                        <td>{{user_site.customer_name}}</td>
                        <td>{{user_site.description}}</td>
                        <td>{{user_site.ip_address}}</td>
                        <td>{{user_site.port_number}}</td>
                        <td class="text-center"><span class="badge badge-danger item-clickable" (click)="deleteUserCustomerSite(use_user._id, user_site._id)"><i class="fa fa-trash" aria-hidden="true"></i> Elimina</span></td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <div class="row">
                <div class="col-md-12 col-sm-12 mt-1 text-right">
                  <pagination-controls id="user_sites_pagination" class="my-pagination" (pageChange)="page_user_sites = $event"
                                        autoHide="true"
                                        previousLabel="Indietro"
                                        nextLabel="Avanti"
                                        directionLinks="false"
                  >
                  </pagination-controls>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="createUserSiteModal" tabindex="-1" role="dialog" aria-labelledby="createUserSiteModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content" *ngIf="use_user">
        <div class="modal-header">
          <h5 class="modal-title" id="createUserSiteModalLabel">Aggiungi sito</h5>
          <button #btnUserSiteClose type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form name="form" (ngSubmit)="f.form.valid && createUserSite(f, use_user._id)" #f="ngForm" novalidate>
            <p class="login-label">Sito</p>
            <div class="mt-2 mb-3" [ngClass]="{ 'has-error': f.submitted && !customer_site.valid }">
              <div class="input-group mb-2">
                <div class="input-group-prepend">
                  <div class="input-group-text"><i class="fa fa-address-card-o" aria-hidden="true"></i></div>
                </div>                
                <select class="form-control" name="customer_site" [(ngModel)]="model.customer_site" #customer_site="ngModel" required>
                    <option *ngFor="let site of sites" value="{{site._id}}">{{site.customer_name}} - {{site.description}}</option>
                  </select>
                <div *ngIf="f.submitted && !customer_site.valid" class="help-block">
                  <i class="fa fa-times" aria-hidden="true"></i>
                </div>
              </div>
            </div>

            <alert></alert>

            <div class="text-center mt-4">
              <button [disabled]="loading" class="btn btn-primary card-item-title create-down" type="submit">Aggiungi</button>
              <img *ngIf="loading" src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA==" />
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<app-footer></app-footer>
